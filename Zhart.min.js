function Zhart(t){var e=this;if(_.defaults(this,{layers:[],features:[],width:300,height:200,margins:{top:10,left:30,bottom:30,right:10},yScale:d3.scale.linear(),xScale:d3.scale.linear(),xDomain:new Domain([0,10]),yDomain:new Domain([0,10])}),_.extend(this,t),!this.context)throw new TypeError("Context needed :( sorry");this.svg=d3.select(this.context).append("svg").classed("zhart",!0),this.vis=this.svg.append("g").classed("vis",!0),_.each(this.features,function(t){t.init(e)});var i=0;return setInterval(function(){var t=Date.now();e.redraw(),i+=Date.now()-t},16),setInterval(function(){console.log(i/10+"% time spent redrawing"),i=0},1e3),this}function Domain(t){if(!t||!_.isArray(t)||2!==t.length)throw console.log(t),new RangeError("Invalid Domain");return t.startTime=startTime,t.stopTime=stopTime,t}function startTime(){var t=this;this.stopTime();var e=Date.now();this.realTimeInterval=setInterval(function(){var i=Date.now()-e;t[0]+=i,t[1]+=i,e=Date.now()},16)}function stopTime(){clearInterval(this.realTimeInterval),this.realTimeInterval=null}function DataSet(t){return t.closestXIndex=closestXIndex,t.selectIntersection=selectIntersection,t}function selectIntersection(t,e){e=e||.3;var i=(t[1]-t[0])*e,n=this.closestXIndex(t[0]-i),r=this.closestXIndex(t[1]+i)+1;return this.slice(n,r)}function closestXIndex(t,e){e=e||1e3;var i=Math.round((t-this[0][0])/e);for(_.isUndefined(this[i])&&(i=_.last(this)[0]-t<t-_.first(this)[0]?this.length-1:0);!_.isUndefined(this[i-1])&&this[i][0]>t;)i--;for(;!_.isUndefined(this[i+1])&&this[i][0]<t;)i++;if(_.isUndefined(this[i-1]))return i;var n=t-this[i-1][0],r=this[i][0]-t;return r>n?i-1:i}function setOptions(t,e){if(_.isUndefined(this.options[t]))throw new RangeError("set("+t+", "+e+"): Invalid key");if("init"===t||"destroy"===t)throw new RangeError("can not set init or destroy");return this.options[t]=e,this}function setOptions(t,e){if(_.isUndefined(this.options[t]))throw new RangeError("set("+t+", "+e+"): Invalid key");if("init"===t||"destroy"===t)throw new RangeError("can not set init or destroy");return this.options[t]=e,this}function DataSet(t){return t.closestXIndex=closestXIndex,t.selectIntersection=selectIntersection,t}function selectIntersection(t,e){e=e||.3;var i=(t[1]-t[0])*e,n=this.closestXIndex(t[0]-i),r=this.closestXIndex(t[1]+i)+1;return this.slice(n,r)}function closestXIndex(t,e){e=e||1;var i=Math.round((t-this[0][0])/e);for(_.isUndefined(this[i])&&(i=_.last(this)[0]-t<t-_.first(this)[0]?this.length-1:0);!_.isUndefined(this[i-1])&&this[i][0]>t;)i--;for(;!_.isUndefined(this[i+1])&&this[i][0]<t;)i++;if(_.isUndefined(this[i-1]))return i;var n=t-this[i-1][0],r=this[i][0]-t;return r>n?i-1:i}function Domain(t){if(!t||!_.isArray(t)||2!==t.length)throw console.log(t),new RangeError("Invalid Domain");return t.startTime=startTime,t.stopTime=stopTime,t}function startTime(){var t=this;this.stopTime();var e=Date.now();this.realTimeInterval=setInterval(function(){var i=Date.now()-e;t[0]+=i,t[1]+=i,e=Date.now()},16)}function stopTime(){clearInterval(this.realTimeInterval),this.realTimeInterval=null}var _=require("lodash"),d3=require("d3"),Domain=require("./Zhart.Domain"),features=require("./Features.helpers"),layers=require("./Layers.helpers");Zhart.prototype.redraw=function(){var t=this;this.resize(),this.xScale.domain(this.xDomain),this.yScale.domain(this.yDomain),_.each(this.layers,function(e){e.draw(t)})},Zhart.features=features,Zhart.layers=layers,Zhart.prototype.resize=function(){this.svg.attr("width",this.width).attr("height",this.height),this.visWidth=this.width-this.margins.left-this.margins.right,this.visHeight=this.height-this.margins.top-this.margins.bottom,this.vis.attr("width",this.visWidth).attr("height",this.visHeight).attr("transform","translate("+this.margins.left+","+this.margins.top+")"),this.yScale.range([this.visHeight,0]),this.xScale.range([0,this.visWidth])},Zhart.prototype.microchart=function(){var t=this,e=Zhart.features("background","text","dragXDomain");e[0].set("color","orange").set("color","yellow"),e[1].set("color","purple").set("x",200);var i=Zhart.layers("xAxis","yAxis","area","line");i[0].set("ticks","5").set("orient","bottom"),i[2].set("interpolate","basis"),i[3].set("interpolate","basis"),_.each(e,function(e){e.init(t)}),this.layers=i.slice(),this.features=e.slice()},module.exports=Zhart,function(t){"use strict";var e=t.Zhart;e.helpers={}}(this);var _=require("lodash"),features=function(){return _.map(arguments,function(t){return features[t]()})};features.background=function(t){function e(e){i(),n=e.svg.style("background-color",t.color)}function i(){!_.isUndefined(n)&&_.isFunction(n.style)&&n.style("background-color","none")}t=_.isObject(t)||{},_.defaults(t,{color:"grey"});var n;return{options:t,set:setOptions,init:e,destroy:i}},features.text=function(t){function e(e){i(),n=e.svg.append("text").attr("class",t["class"]).text(t.text).attr("x",t.x).attr("y",t.y).attr("fill",t.color)}function i(){n&&_.isFunction(n.remove)&&n.remove()}t=_.isObject(t)||{},_.defaults(t,{"class":null,text:"default text",x:50,y:50,color:"black"});var n;return{options:t,set:setOptions,init:e,destroy:i}},features.dragXDomain=function(t){function e(t){function e(){d3.event.sourceEvent.stopPropagation(),d3.select(this).classed("dragging",!0)}function n(){var e=t.xScale.invert(0)-t.xScale.invert(d3.event.dx);t.xDomain[0]+=e,t.xDomain[1]+=e}function r(){d3.select(this).classed("dragging",!1)}var s=t.svg.dragBehave||d3.behavior.drag();t.svg.dragBehave=s,i(),s.on("dragstart.xDomain",e).on("drag.xDomain",n).on("dragend.xDomain",r),t.svg.call(s)}function i(){}return t=_.isObject(t)||{},_.defaults(t,{}),{options:t,set:setOptions,init:e,destroy:i}},features.dragYDomain=function(t){function e(t){function e(){d3.event.sourceEvent.stopPropagation(),d3.select(this).classed("dragging",!0)}function i(){var e=t.yScale.invert(0)-t.yScale.invert(d3.event.dy);t.yDomain[0]+=e,t.yDomain[1]+=e}function n(){d3.select(this).classed("dragging",!1)}var r=t.svg.dragBehave||d3.behavior.drag();t.svg.dragBehave=r,r.on("dragstart.yDomain",e).on("drag.yDomain",i).on("dragend.yDomain",n),t.svg.call(r)}function i(){}return t=_.isObject(t)||{},_.defaults(t,{}),{options:t,set:setOptions,init:e,destroy:i}},module.exports=features;var _=require("lodash"),layers=function(){return _.map(arguments,function(t){return layers[t]})};layers.xAxis=function(t){function e(e){var i=d3.svg.axis().scale(e.xScale).orient(t.orient).ticks(t.ticks).tickSize(t.tickSize).tickFormat(t.tickFormat),n=e.vis.selectAll("g.x-axis").data([1]);n.enter().append("g").attr("class","x-axis"),n.attr("transform","translate(0,"+e.visHeight+")").call(i),n.exit().remove()}return t=_.isObject(t)||{},_.defaults(t,{ticks:3,tickSize:1,orient:"bottom",tickFormat:function(e){return t.format(new Date(e))},format:d3.time.format("%X")}),{options:t,set:setOptions,draw:e}}(),layers.yAxis=function(t){function e(e){var i=d3.svg.axis().scale(e.yScale).orient(t.orient).ticks(t.ticks).tickSize(t.tickSize),n=e.vis.selectAll("g.y-axis").data([1]);n.enter().append("g").attr("class","y-axis"),n.call(i),n.exit().remove()}return t=_.isObject(t)||{},_.defaults(t,{ticks:3,tickSize:1,orient:"left"}),{options:t,set:setOptions,draw:e}}(),layers.line=function(t){function e(e){var i=_.map(e.dataSets,function(t){return t.selectIntersection(e.xDomain)}),n=d3.svg.line().x(function(t){return e.xScale(t[0])}).y(function(t){return e.yScale(t[1])}).interpolate(t.interpolate),r=function(t,e){return"line "+e},s=e.vis.selectAll("path.line").data(i);s.enter().append("svg:path").style("fill","none").attr("stroke",t.stroke).attr("stroke-width",t.strokeWidth),s.attr("d",n).attr("class",r),s.exit().remove()}return t=_.isObject(t)||{},_.defaults(t,{interpolate:"line",stroke:"blue",strokeWidth:.8}),{options:t,set:setOptions,draw:e}}(),layers.area=function(t){function e(e){var i=_.map(e.dataSets,function(t){return t.selectIntersection(e.xDomain)}),n=d3.svg.area().x(function(t){return e.xScale(t[0])}).y0(function(){return e.yScale(0)}).y1(function(t){return e.yScale(t[1])}).interpolate(t.interpolate),r=function(t,e){return"area "+e},s=e.vis.selectAll("path.area").data(i);s.enter().append("svg:path").style("fill",t.fill).style("opacity",.5).attr("stroke","none").attr("stroke-width",0),s.attr("d",n).attr("class",r),s.exit().remove()}return t=_.isObject(t)||{},_.defaults(t,{interpolate:"line",fill:"red"}),{options:t,set:setOptions,draw:e}}(),module.exports=layers;var _=require("lodash");module.exports=DataSet;var _=require("lodash");module.exports=Domain;var Zhart=require("./Zhart.Core"),DataSet=require("./Zhart.DataSet"),Domain=require("./Zhart.Domain"),_=require("lodash"),context=document.getElementById("zhart"),context2=document.getElementById("zhart2"),now=Date.now(),dataSets=[new DataSet([[now,0]]),new DataSet([[now,0]])],xDomain=new Domain([now-2e4,now-1e3]);xDomain.startTime();var yDomain=new Domain([0,10]);new Zhart({context:context2,width:500,height:300,dataSets:dataSets,xDomain:xDomain,yDomain:yDomain}).microchart(),new Zhart({context:context,width:500,height:80,dataSets:dataSets,xDomain:xDomain,yDomain:yDomain}).microchart(),setInterval(function(){_.each(dataSets,function(t){t.push([_.last(t)[0]+1e3,10*Math.random(10)])})},100);